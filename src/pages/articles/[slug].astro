---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// Generate Static Paths
export async function getStaticPaths() {
    const allArticles = await getCollection('articles', ({ data }) => !data.draft);

    return allArticles.map(article => ({
        params: { slug: article.slug },
        props: { article } // pass the whole article as a prop
    }));
}

// Props From getStaticPaths
const { article } = Astro.props;
const ArticleBody = article.render ? (await article.render()).Content : article.component;
---
<Layout seoTitle={article.data.title}>
    <article class="@container mx-auto mt-4 px-4 container">
        <!-- Article Header -->
        <div class="mx-auto max-w-4xl container">
            <h1 class="font-extrabold text-zinc-50 text-2xl">{article.data.title}</h1>
            <!-- Article Meta -->
            <div class="flex flex-row flex-wrap justify-between gap-2">
                <span>By {article.data.author || "Unknown Author"}</span>
                <time datetime={article.data.publishDate}>
                    {new Date(article.data.publishDate).toLocaleDateString('en-GB')}
                </time>
            </div>
        </div>
        <!-- Cover Image Wrapper -->
        <div class="">
            <!-- Cover Image -->
            <Image src={article.data.cover} alt={article.data.alt || article.data.title} class="my-4 rounded-md w-full object-cover aspect-[16/9]" width="1200" height="800" loading="eager" />
        </div>
        <!-- Article Content -->
        <div class="prose-headings:m-0 prose-img:m-0 mx-auto prose-p:mt-4 prose-p:mb-4 prose-img:rounded-md max-w-4xl prose-headings:text-zinc-50 prose-p:text-zinc-300 prose-p:text-base prose-h3:text-lg prose-h2:text-xl prose">
            <ArticleBody  />
        </div>
    </article>
</Layout>